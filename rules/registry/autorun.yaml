# Правила для обнаружения подозрительного автозапуска

rules:
  # Модификация стандартных путей автозапуска
  autorun_modification:
    paths:
      - "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
      - "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
      - "HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run"
      - "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
      - "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
    indicators:
      - ".*\\Windows\\Temp\\.*\\.exe"
      - ".*\\AppData\\Local\\Temp\\.*\\.exe"
      - ".*\\Users\\Public\\.*\\.exe"
      - ".*\\ProgramData\\.*\\.exe"
      - "cmd.exe /c"
      - "powershell.exe -"
      - "wscript.exe"
      - "rundll32.exe"
      
  # Модификация планировщика задач
  scheduled_tasks:
    paths:
      - "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache"
    indicators:
      - ".*\\Windows\\Temp\\.*"
      - ".*\\AppData\\Local\\Temp\\.*"
      - ".*\\Users\\Public\\.*"
      
  # Модификация служб
  services_modification:
    paths:
      - "HKLM\\SYSTEM\\CurrentControlSet\\Services"
    indicators:
      - ".*\\Windows\\Temp\\.*\\.exe"
      - ".*\\AppData\\Local\\Temp\\.*\\.exe"
      - ".*\\Users\\Public\\.*\\.exe"
      - ".*\\ProgramData\\.*\\.exe"
      - "cmd.exe"
      - "powershell.exe"
      
  # Модификация расширений оболочки
  shell_extensions:
    paths:
      - "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Shell Extensions\\Approved"
    indicators:
      - ".*\\Windows\\Temp\\.*\\.dll"
      - ".*\\AppData\\Local\\Temp\\.*\\.dll"
      - ".*\\Users\\Public\\.*\\.dll"
      
  # Модификация AppInit_DLLs
  appinit_dlls:
    paths:
      - "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs"
    indicators:
      - ".*\\.dll"
      
  # Модификация Winlogon
  winlogon_modification:
    paths:
      - "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"
    indicators:
      - "Userinit=.*,.*"  # Множественные записи
      - "Shell=.*,.*"     # Множественные записи 

  suspicious_autorun:
    description: "Подозрительные записи автозапуска"
    paths:
      - "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
      - "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
      - "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
      - "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
      - "HKLM\\SYSTEM\\CurrentControlSet\\Services"
    indicators:
      - "cmd.exe"
      - "powershell.exe"
      - "wscript.exe"
      - "cscript.exe"
      - "regsvr32.exe"
      - "rundll32.exe"
    severity: high
    tags:
      - autorun
      - persistence 